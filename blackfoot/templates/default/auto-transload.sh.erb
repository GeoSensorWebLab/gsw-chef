#!/bin/bash

DLOG="<%= @logdir %>/download.log"
ULOG="<%= @logdir %>/upload.log"
STATIONS=$(cat -)

touch "$DLOG"
touch "$ULOG"
cd "<%= @workdir %>"

for station in $STATIONS; do
  ruby transload get observations --source environment_canada \
    --station $station --cache <%= @cachedir %> | tee -a $DLOG
  ruby transload put observations --source environment_canada \
    --station $station --cache <%= @cachedir %> --date latest \
    --destination "<%= @sta_endpoint %>" | tee -a $ULOG
done
