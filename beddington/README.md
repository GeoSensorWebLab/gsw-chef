# `beddington` cookbook

Cookbook for setting up a node with DokuWiki for ArcticConnect.

## Supported Platforms

* Ubuntu Server 20.04 LTS

## Usage

## Manual Pre-configuration

The setup of mounted volumes for the instance must be done manually, as there is no straight-forward way of doing this that is compatible with both OpenStack and Test-Kitchen (the local development environment). The reason is that the ID/UUID generated by the infrastructure cannot easily be matched to any volume serial number visible in the system. For OpenStack the volume ID is directly visible in the disk ID under `/dev/disk/by-id`, but in Test-Kitchen (running under VirtualBox) only *part* of the UUID is visible in that same directly.

A volume should already be created and mounted by either Terraform (in production) or Test-Kitchen (in testing). This volume will not be formatted with any filesystem, which must be done manually.

```
$ sudo apt update
$ sudo apt install zfsutils-linux
$ sudo ls -lh /dev/disk/by-id
... (find the raw disk volume in this list)
$ sudo zpool create -f -O compression=on storage /dev/disk/by-id/ata-VBOX_HARDDISK_VBf9addf63-22cf6881
$ sudo zpool list
NAME      SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
storage  9.50G   114K  9.50G        -         -     0%     0%  1.00x    ONLINE  -
```

The cookbook recipes will **fail** if a ZFS pool named `storage` is not available.

## `beddington::default` recipe

Installs ZFS for Linux, Docker, Docker Compose, and DokuWiki running under Docker.

## Attributes

Attributes are documented in the `attributes` directory.

## License and Authors

James Badger (jpbadger@ucalgary.ca)
